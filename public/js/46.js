(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{H376:function(t,e,i){"use strict";i.r(e);var s={components:{NewPostModal:i("KZnh").default},data:function(){return{showPostModal:!1}},name:"NewPostCard"},a=i("KHd+"),n=Object(a.a)(s,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return null!=t.$page.props.user?i("div",{staticClass:"position-relative card"},[i("new-post-modal",{attrs:{show:t.showPostModal},on:{done:function(e){return t.$emit("done")},"update:show":function(e){t.showPostModal=e}}}),t._v(" "),i("div",{staticClass:"new-post-body"},[i("div",{staticClass:"text d-flex align-items-center"},[i("lazy-image",{staticClass:"profile-sm ml-2 mb-0",attrs:{"img-class":"profile-sm",loading:"lazy",src:t.$page.props.user.profile}}),t._v(" "),i("div",{staticClass:"w-100 clickable",staticStyle:{"border-radius":"15px",background:"#f5f5f5",padding:"8px 12px"},on:{click:function(e){t.showPostModal=!0}}},[i("span",{staticClass:"new-post--placeholder"},[t._v("\n\t\t\t\t\t"+t._s("به چی فکر می‌کنی "+t.$page.props.user.first_name+"؟")+"\n\t\t\t\t")])])],1),t._v(" "),i("div",{staticClass:"d-flex text-muted align-items-center justify-content-between new-post-actions"},[i("a",{staticClass:"new-post--action clickable",on:{click:function(e){t.showPostModal=!0}}},[i("i",{staticClass:"material-icons-outlined"},[t._v("crop_original")]),t._v(" رسانه ")]),t._v(" "),i("inertia-link",{staticClass:"new-post--action",attrs:{href:"/articles/create"}},[i("i",{staticClass:"material-icons-outlined"},[t._v("article")]),t._v(" مقاله ")]),t._v(" "),t._m(0)],1)])],1):t._e()}),[function(){var t=this.$createElement,e=this._self._c||t;return e("a",{staticClass:"new-post--action disabled"},[e("i",{staticClass:"material-icons-outlined"},[this._v("poll")]),this._v(" نظر سنجی ")])}],!1,null,null,null);e.default=n.exports},KZnh:function(t,e,i){"use strict";i.r(e);var s=i("o0o1"),a=i.n(s),n=i("Ql3O"),o=i("jvcc"),l=i("LgIB"),r=i("osEC"),c=i("Wz0r"),d=i("iWeN");function p(t,e,i,s,a,n,o){try{var l=t[n](o),r=l.value}catch(t){return void i(t)}l.done?e(r):Promise.resolve(r).then(s,a)}function u(t){return function(){var e=this,i=arguments;return new Promise((function(s,a){var n=t.apply(e,i);function o(t){p(n,s,a,o,l,"next",t)}function l(t){p(n,s,a,o,l,"throw",t)}o(void 0)}))}}var h={props:{post:{type:Object,default:void 0,required:!1}},methods:{loadMentions:function(){var t=arguments,e=this;return u(a.a.mark((function i(){var s;return a.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return s=t.length>0&&void 0!==t[0]?t[0]:null,e.loadingMentions=!0,i.next=4,new Promise((function(t){var e={};null!=s&&(e.q=s),axios.post("/slugsearch",e).then((function(e){t(e.data.pages)}))}));case 4:e.mentionItems=i.sent,e.loadingMention=!1;case 6:case"end":return i.stop()}}),i)})))()},onShown:function(){var t=this;this.post&&(null!=this.post.category&&(this.category=this.post.category),this.text=this.post.text,"private"==this.post.show&&(this.showType=this.showTypesItems[1]),this.tags=this.post.tags,this.post.medias&&(this.post.media_type.startsWith("video")?this.video=this.post.medias:(this.isCroppingDone=!0,this.image=this.post.medias,this.$nextTick((function(){t.$refs.cropResult.src=t.image})))))},newCategory:function(t){this.categories.push({name:t,id:t}),axios.post("/categories",{name:t})},cropImage:function(){var t=this;this.isCroppingDone=!0,this.isCropping=!1;var e=this.$refs.cropper.getResult(),i=e.canvas,s=e.coordinates;i.toBlob((function(e){t.$refs.cropResult.src=URL.createObjectURL(e),t.cropCordinates=s}))},rotateImage:function(){var t=this,e=document.createElement("img");e.crossOrigin="anonymous",e.src=this.image,e.onload=function(){var i=document.createElement("canvas"),s=i.getContext("2d");e.width>e.height?(i.width=e.height,i.height=e.width,s.translate(e.height,e.width/e.height)):(i.height=e.width,i.width=e.height,s.translate(e.height,e.width/e.height)),s.rotate(Math.PI/2),s.drawImage(e,0,0),t.image=i.toDataURL()}},removeMedia:function(){this.isCroppingDone=!1,this.$refs.cropResult&&(this.$refs.cropResult.src=""),this.file=!1,this.image=void 0,this.video=void 0},imageSelect:function(t){var e=t.target;if(e.files&&e.files[0]){var i=t.target.files[0],s=i.type,a=URL.createObjectURL(i);s.startsWith("image")?(this.file=i,this.video=void 0,this.image=a,this.isCropping=!0):s.startsWith("video")&&(this.isCropping=!1,this.file=i,this.image=void 0,this.video=a)}},submitPost:function(){var t=this;this.loading=!0;var e=new FormData;e.append("text",this.text),this.category&&e.append("category",this.category.name),e.append("type",this.showType.value),e.append("tags",JSON.stringify(this.tags)),void 0!==this.file&&(e.append("media",this.file),void 0!==this.cropCordinates&&e.append("sizes",JSON.stringify(this.cropCordinates))),this.post?(e.append("_method","PUT"),axios.post(this.$APP_URL+"/posts/"+this.post.id,e).then((function(e){var i=e.data;if(i.result)c.Inertia.reload({only:["posts"]}),t.$emit("done"),t.$emit("update:show",!1),t.text=void 0,t.category=void 0,t.tags=[],t.txtlen="0%",t.image=void 0,t.video=void 0,t.file=void 0,t.cropCordinates=void 0,t.loading=!1,t.leftCharacter=2500;else{var s=i.errors;t.handleError(s)}})).catch((function(t){})).then((function(){return t.loading=!1}))):axios.post(this.$APP_URL+"/posts",e).then((function(e){var i=e.data;if(i.result)c.Inertia.reload({only:["posts"]}),t.$emit("done"),t.$emit("update:show",!1),t.text=void 0,t.category=void 0,t.tags=[],t.txtlen="0%",t.image=void 0,t.video=void 0,t.file=void 0,t.cropCordinates=void 0,t.loading=!1,t.leftCharacter=2500;else{var s=i.errors;t.handleError(s)}})).catch((function(t){})).then((function(){return t.loading=!1}))},initialData:function(){return{showTypesItems:[{name:"همه",value:"public",icon:"public"},{name:"فقط دوستان",value:"private",icon:"group"}],showType:void 0,category:void 0,text:void 0,categories:[],tags:[],txtlen:"0%",isCropping:!1,isCroppingDone:!1,image:void 0,video:void 0,file:void 0,cropCordinates:void 0,loading:!1,leftCharacter:2500,loadingMention:!1,mentionItems:[]}}},watch:{text:function(t){this.txtlen=t.length/2500*100+"%",this.leftCharacter=2500-t.length}},created:function(){this.showType=this.showTypesItems[0],this.$page.props.user&&null!=this.$page.props.currentPage.categories&&(this.categories=this.$page.props.currentPage.categories)},data:function(){return this.initialData()},components:{Cropper:r.a,TagInput:l.a,Mentionable:o.a,FileInput:d.a},mixins:[n.a],name:"NewPostModal"},g=i("KHd+"),v=Object(g.a)(h,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return null!=t.$page.props.user?i("b-modal",{attrs:{"no-close-on-backdrop":t.isCropping,"hide-footer":"","body-class":"pb-2",size:"md",title:"تولید محتوای تازه",centered:!0},on:{show:t.onShown},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[i("div",{staticClass:"w-100",attrs:{action:"/posts","data-ajax":"",method:"POST","data-reload":"1",enctype:"multipart/form-data"}},[i("div",{staticClass:"new-post position-relative"},[i("div",{staticClass:"selections"},[i("div",{staticClass:"userinfo col-lg-4 p-0"},[i("lazy-image",{staticClass:"profile-sm",attrs:{src:t.$page.props.user.profile,"img-class":"profile-sm",loading:"lazy"}}),t._v(" "),i("strong",[t._v(t._s(t.$page.props.user.name))])],1),t._v(" "),i("div",{staticClass:"categoryandtype"},[i("div",{staticClass:"mx-1 col-lg-5 p-0"},[i("tselect",{attrs:{items:t.showTypesItems,showNewItem:!1,direction:"rtl"},model:{value:t.showType,callback:function(e){t.showType=e},expression:"showType"}})],1),t._v(" "),i("div",{staticClass:"ml-1 p-0 col-lg-7"},[i("tselect",{attrs:{items:t.categories,"value-option":"name",showNewItem:!0,direction:"rtl"},on:{"new-item":t.newCategory},model:{value:t.category,callback:function(e){t.category=e},expression:"category"}},[i("i",{staticClass:"material-icons-outlined"},[t._v("layers")]),t._v(" دسته‌بندی ")])],1)])]),t._v(" "),i("div",{staticClass:"text px-0"},[i("div",{staticClass:"textarea"},[i("Mentionable",{attrs:{keys:["@"],items:t.mentionItems,"filtering-disabled":""},on:{open:function(e){return t.loadMentions()},search:function(e){return t.loadMentions(e)}},scopedSlots:t._u([{key:"no-result",fn:function(){return[t._v("\n\t\t\t\t\t\t\t"+t._s(t.loading?"درحال بارگذاری..":"نتیجه‌ای یافت نشد")+"\n\t\t\t\t\t\t")]},proxy:!0}],null,!1,577036228)},[i("textarea-autosize",{staticClass:"w-100 autoresize autodirection",attrs:{"min-height":201,rows:"8",placeholder:"اگر در خویش میل نوشتن سراغ کردی باید سه چیز در تو باشد. شناختی، هنری و سحری (جبران خلیل جبران)",maxlength:"2500"},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}})],1),t._v(" "),i("div",{staticClass:"character-counter"},[i("span",{staticClass:"counter tex-dark"},[t._v(t._s(t.leftCharacter))]),t._v(" "),i("div",{staticClass:"progress ml-1 mb-0",staticStyle:{width:"100px",height:"5px"}},[i("div",{staticClass:"progress-bar",style:{width:t.txtlen},attrs:{role:"progressbar","aria-valuemin":"0","aria-valuemax":"100"}})])])],1)]),t._v(" "),i("div",{staticClass:"mediatag"},[void 0!==t.image||void 0!==t.video?i("div",{staticClass:"position-relative",attrs:{id:"mediaPreview"}},[i("div",{staticClass:"topleftactions"},[t.isCropping?i("button",{staticClass:"closebtn",staticStyle:{height:"30px",width:"30px",padding:"3px"},on:{click:t.rotateImage}},[i("i",{staticClass:"material-icons"},[t._v("rotate_left")])]):t._e(),t._v(" "),void 0!==t.image||void 0!==t.video?i("button",{staticClass:"closebtn",on:{click:t.removeMedia}},[i("i",{staticClass:"material-icons font-22"},[t._v("close")])]):t._e()]),t._v(" "),t.isCropping?i("cropper",{ref:"cropper",staticClass:"cropper",attrs:{src:t.image,"stencil-props":{aspectRatio:16/12}}}):t._e(),t._v(" "),void 0!==t.video&&null!==t.video?i("video",{staticClass:"w-100",attrs:{src:t.video,controls:""}}):t._e(),t._v(" "),t.isCroppingDone?i("img",{ref:"cropResult",staticClass:"w-100"}):t._e(),t._v(" "),t.isCropping&&void 0!==t.image&&null!==t.image?i("div",{staticClass:"w-100 d-flex justify-content-center mb-3 position-relative"},[i("div",{staticClass:"cropperactions"},[i("button",{attrs:{type:"button"},on:{click:t.cropImage}},[t._v("تایید")]),t._v(" "),i("button",{attrs:{type:"button"},on:{click:function(e){t.isCropping=!1}}},[t._v("لغو")])])]):t._e()],1):t._e(),t._v(" "),i("div",{staticClass:"d-flex justify-content-end align-items-center my-2"},[i("file-input",{on:{change:t.imageSelect}},[i("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"text-grey hover-dark d-flex align-items-center clickable",attrs:{title:"افزودن ویدیو / تصویر"}},[i("i",{staticClass:"material-icons-outlined hover-dark"},[t._v("crop_original")])])]),t._v(" "),i("span",{staticClass:"splitor-line mx-2"}),t._v(" "),i("inertia-link",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"text-grey hover-dark d-flex align-items-center font-12",attrs:{href:"/articles/create","data-toggle":"tooltip",title:"نوشتن مقاله"}},[i("i",{staticClass:"material-icons-outlined hover-dark"},[t._v("article")])])],1),t._v(" "),i("div",{staticClass:"tags pr-0 pb-3"},[i("TagInput",{staticClass:"w-100",model:{value:t.tags,callback:function(e){t.tags=e},expression:"tags"}})],1)]),t._v(" "),i("div",{staticClass:"media pl-2"},[i("input",{attrs:{type:"hidden",name:"sizes",value:"",id:"postimage-options"}})]),t._v(" "),i("div",{staticClass:"submit position-relative"},[i("loading-button",{staticClass:"btn btn-primary",staticStyle:{"margin-bottom":"-8px"},attrs:{loading:t.loading},nativeOn:{click:function(e){return t.submitPost(e)}}},[t._v(" ارسال ")])],1)])])]):t._e()}),[],!1,null,null,null);e.default=v.exports},LgIB:function(t,e,i){"use strict";var s={methods:{removeLastTag:function(){(null==this.input||this.input.length<1)&&(this.tags.pop(),this.$emit("input",this.tags))},removeTag:function(t){this.tags.splice(t,1),this.$emit("input",this.tags)},addTag:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null!=t?-1==this.tags.indexOf(t)&&(this.tags.push(t),this.input=null,this.$emit("input",this.tags),this.suggestions=[]):null!=this.input&&-1==this.tags.indexOf(this.input)&&(this.tags.push(this.input),this.input=null,this.$emit("input",this.tags))},check:function(){(null==this.val||this.val.length<1)&&this.required||this.notValid?this.invalid=!0:this.invalid=!1}},created:function(){this.tags=this.value},watch:{value:function(){this.tags=this.value},input:function(t){var e=this;null!=t&&t.length>0&&axios.get(this.$APP_URL+"/gettags?term="+t+"&q="+t).then((function(t){var i=t.data;i.results.length>0&&(e.suggestions=i.results)}))}},data:function(){return{tags:[],suggestions:[],input:null,invalid:!1}},props:{notValid:{type:Boolean,default:!1,required:!1},value:{type:Array,required:!1},required:{type:Boolean,default:!1,required:!1},type:{type:String,default:"text",required:!1},maxlength:{type:Number,default:15e3,required:!1},inputClass:{type:String,default:"",required:!1},placeholder:{type:String,default:void 0,required:!1}}},a=i("KHd+"),n=Object(a.a)(s,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"d-flex tag-input",class:{focus:null!=t.tags&&null!=t.tags&&t.tags.length>0}},[i("div",{staticClass:"tags"},t._l(t.tags,(function(e,s){return i("div",{key:"newpost_tag_"+e+"_"+s,staticClass:"tag-item",on:{click:function(e){return t.removeTag(s)}}},[t._v("\n            "+t._s(e)+"\n        ")])})),0),t._v(" "),"checkbox"===t.type?i("input",{directives:[{name:"model",rawName:"v-model",value:t.input,expression:"input"}],staticClass:"input",class:[t.inputClass,{invalid:t.invalid}],attrs:{placeholder:" ",disabled:null!=t.tags&&null!=t.tags&&3==t.tags.length,maxlength:t.maxlength,type:"checkbox"},domProps:{checked:Array.isArray(t.input)?t._i(t.input,null)>-1:t.input},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addTag()},blur:t.check,change:function(e){var i=t.input,s=e.target,a=!!s.checked;if(Array.isArray(i)){var n=t._i(i,null);s.checked?n<0&&(t.input=i.concat([null])):n>-1&&(t.input=i.slice(0,n).concat(i.slice(n+1)))}else t.input=a}}}):"radio"===t.type?i("input",{directives:[{name:"model",rawName:"v-model",value:t.input,expression:"input"}],staticClass:"input",class:[t.inputClass,{invalid:t.invalid}],attrs:{placeholder:" ",disabled:null!=t.tags&&null!=t.tags&&3==t.tags.length,maxlength:t.maxlength,type:"radio"},domProps:{checked:t._q(t.input,null)},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addTag()},blur:t.check,change:function(e){t.input=null}}}):i("input",{directives:[{name:"model",rawName:"v-model",value:t.input,expression:"input"}],staticClass:"input",class:[t.inputClass,{invalid:t.invalid}],attrs:{placeholder:" ",disabled:null!=t.tags&&null!=t.tags&&3==t.tags.length,maxlength:t.maxlength,type:t.type},domProps:{value:t.input},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addTag()},blur:t.check,input:function(e){e.target.composing||(t.input=e.target.value)}}}),t._v(" "),t._m(0),t._v(" "),t.suggestions.length>0&&null!=this.input&&this.input.length>0?i("div",{staticClass:"tags-suggestion"},[i("div",{staticClass:"tags flex-wrap"},t._l(t.suggestions,(function(e,s){return i("div",{key:"suggested_tag_"+e+"_"+s,staticClass:"tag-item",on:{click:function(i){return t.addTag(e.text)}}},[t._v("\n                "+t._s(e.text)+"\n            ")])})),0)]):t._e()])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("label",{staticClass:"d-flex align-items-center"},[this._v("\n        برچسب‌ها\n        "),e("small",{staticClass:"max-text mr-1"},[this._v("حداکثر 3 برچسب")])])}],!1,null,null,null);e.a=n.exports}}]);